<script src="jquery-1.10.2.js"></script>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" type="text/css" href="kumon.css" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0, shrink-to-fit=no">
</head>

<body>
    
    <div class="main">
        <div class="suject">
            <input type="button" value="數學" id="math">
            <input type="button" value="國語" id="chi">
            <input type="button" value="英文" id="eng">
        </div>
    <span id="spanid">教材</span><select name="" id="no">
        
    </select>
    <br>
    <span id="spanid">編號1</span><select name="" id="src">
        <option value="1">1</option>
        <option value="11">11</option>
        <option value="21">21</option>
        <option value="31">31</option>
        <option value="41">41</option>
        <option value="51">51</option>
        <option value="61">61</option>
        <option value="71">71</option>
        <option value="81">81</option>
        <option value="91">91</option>
        <option value="101">101</option>
        <option value="111">111</option>
        <option value="121">121</option>
        <option value="131">131</option>
        <option value="141">141</option>
        <option value="151">151</option>
        <option value="161">161</option>
        <option value="171">171</option>
        <option value="181">181</option>
        <option value="191">191</option>
    </select>
    <br>
    <span id="spanid">編號2</span><select name="" id="dst">
        
    </select>
    <br>
    <span id="spanid">數量</span><input type="text" id ="count"oninput="value=value.replace(/[^\d]/g,'')">
    <br>
  <button id="mathsave" >儲存</button>
  <button id="chisave" >儲存</button>
  <button id="engsave" >儲存</button>
  
</div>
</body>
</html>
<script>
    
    var src=$("#src").val();
    var dst=$("#dst").val();
    var no=$("#no").val();
    var count=$("#count").val();
    var tupleMNo = Object.freeze({ "6A":2,"5A":3,"4A":4,"3A":5,"2A":6,A:7,B:8,C:9,D:10,E:11,F:12,G:13,H:14,I:15,J:16,K:17,L:18,M:19,N:20,O:21,P:22 });
    var tupleCNo = Object.freeze({ "7A":2,"6A":3,"5A":4,"4A":5,"3A":6,"2A":7,A:8,B:9,C:10,D:11,E:12,F:13,G:14,H:15,I:16,J:17,K:18,L:19 });
    var tupleENo = Object.freeze({ "Z1":2,"Z2":3,"Z3":4,"5A":5,"4A":6,"3A":7,"2A":8,A:9,B:10,C:11,D:12,E:13,F:14,G:15,H:16,I:17,J:18,K:19,L:20,M:21 });
    var tupleSrc = Object.freeze({ 1:2, 11:3,21:4,31:5,41:6,51:7,61:8,71:9,81:10,91:11,101:12,111:13,121:14,131:15,141:16,151:17,161:18,171:19,181:20,191:21 })
    var suject=0;
    var id = new Array(10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200); 
    var value = new Array(10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200);
    var select = document.getElementById("dst"); 
    select.length = 1;
    select.options[0].selected = true;
    for(var x = 0;x<id.length;x++){ 
        var option = document.createElement("option"); 
        option.setAttribute("value",id[x]);
        option.appendChild(document.createTextNode(value[x])); 
        select.appendChild(option);
    } 
    $(function() {

    $('#mathsave').on('click', function() {
        var src=Number($("#src").val());
        var dst=Number($("#dst").val());
        var no=$("#no").val();
        var count=Number($("#count").val());
        var dataNum=(dst-src)/10.0;
        dataNum=parseInt(dataNum)+1;
        if(src>dst){
            alert("請輸入正確");
            return;
        }
        if(count==0){
            alert("請輸入數量");
            return;
        }
        if(confirm("請確認\n"+"數學"+"\n"+no+"教材\n"+src+"~"+dst+"\n"+count+"本")){
            var row=Number(tupleSrc[$("#src").val()]);
            var col=Number(tupleMNo[$("#no").val()]);
            for(var i=0;i<dataNum;i++){
            a = {
                row:row,
                col:col,
                value:count,
            };
            
            $.get('https://script.google.com/macros/s/AKfycbwOpQ-ooaPNj_QqOxmo88KVWaGVQno4Lsmr91SE09x4EsBjCbw/exec', a);
            row=row+1;
            }
            $('#mathsave').text("儲存中");
            $('#mathsave').attr("disabled","disabled");
            $('#mathsave').css("background-color","gray");
            var time=dataNum*1400;
            setTimeout(() => {
                $('#mathsave').attr("disabled",false);
                $('#mathsave').css("background-color","#7ecdf4");
                $('#mathsave').text("儲存");
            }, time);
        }
    });

    $('#chisave').on('click', function() {
        var src=Number($("#src").val());
        var dst=Number($("#dst").val());
        var no=$("#no").val();
        var count=Number($("#count").val());
        var dataNum=(dst-src)/10.0;
        dataNum=parseInt(dataNum)+1;
        if(src>dst){
            alert("請輸入正確");
            return;
        }
        if(count==0){
            alert("請輸入數量");
            return;
        }
        if(confirm("請確認\n"+"國語"+"\n"+no+"教材\n"+src+"~"+dst+"\n"+count+"本")){
            var row=Number(tupleSrc[$("#src").val()]);
            var col=Number(tupleCNo[$("#no").val()]);
            for(var i=0;i<dataNum;i++){
            a = {
                row:row,
                col:col,
                value:count,
            };
            $('#chisave').text("儲存中");
            $.get('https://script.google.com/macros/s/AKfycbwX34dNgpc4GxoUCztleHWE6w37FAp_IfoAWJGKEe4gFHWXM6N2/exec', a);
            row=row+1;
            }
            
            $('#chisave').attr("disabled","disabled");
            $('#chisave').css("background-color","gray");
            var time=dataNum*1400;
            setTimeout(() => {
                $('#chisave').text("儲存");
                $('#chisave').attr("disabled",false);
                $('#chisave').css("background-color","#7ecdf4");
            }, time);
        }
    });
    $('#engsave').on('click', function() {
        var src=Number($("#src").val());
        var dst=Number($("#dst").val());
        var no=$("#no").val();
        var count=Number($("#count").val());
        var dataNum=(dst-src)/10.0;
        dataNum=parseInt(dataNum)+1;
        if(src>dst){
            alert("請輸入正確");
            return;
        }
        if(count==0){
            alert("請輸入數量");
            return;
        }
        if(confirm("請確認\n"+"英文"+"\n"+no+"教材\n"+src+"~"+dst+"\n"+count+"本")){
            var row=Number(tupleSrc[$("#src").val()]);
            var col=Number(tupleENo[$("#no").val()]);
            for(var i=0;i<dataNum;i++){
            a = {
                row:row,
                col:col,
                value:count,
            };
            $('#engsave').text("儲存中");
            $.get('https://script.google.com/macros/s/AKfycbz4RCW9GAx9g7pxAOvZ6O_fzSEZyOzPVsFcUWgB73hztWW37WU/exec', a);
            row=row+1;
            }
            
            $('#engsave').attr("disabled","disabled");
            $('#engsave').css("background-color","gray");
            var time=dataNum*1400;
            setTimeout(() => {
                $('#engsave').text("儲存");
                $('#engsave').attr("disabled",false);
                $('#engsave').css("background-color","#7ecdf4");
            }, time);
        }
    });

    });
    $("#src").change(function(){
        var srcval=Number($("#src").val());
        var id = new Array(10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200); 
        var value = new Array(10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200);
        var select = document.getElementById("dst"); 
        select.length = 1;
        select.options[0].selected = true;
        var key=parseInt(srcval/10.0);
        for(var x = key;x<id.length;x++){ 
            var option = document.createElement("option"); 
            option.setAttribute("value",id[x]);
            option.appendChild(document.createTextNode(value[x])); 
            select.appendChild(option);
        } 
    })
    $('#math').on('click', function() {
        $('#chisave').css("display","none");
        $('#engsave').css("display","none");
        $('#mathsave').css("display","block");
        var id = new Array("6A","5A","4A","3A","2A","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q"); 
        var value = new Array("6A","5A","4A","3A","2A","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q"); 
        var select = document.getElementById("no"); 
        select.length = 1;
        select.options[0].selected = true;
        for(var x = 0;x<id.length;x++){ 
            var option = document.createElement("option"); 
            option.setAttribute("value",id[x]);
            option.appendChild(document.createTextNode(value[x])); 
            select.appendChild(option);
        } 
    })
    $('#chi').on('click', function() {
        $('#chisave').css("display","block");
        $('#engsave').css("display","none");
        $('#mathsave').css("display","none");
        var id = new Array("7A","6A","5A","4A","3A","2A","A","B","C","D","E","F","G","H","I","J","K","L"); 
        var value = new Array("7A","6A","5A","4A","3A","2A","A","B","C","D","E","F","G","H","I","J","K","L"); 
        var select = document.getElementById("no"); 
        select.length = 1;
        select.options[0].selected = true;
        for(var x = 0;x<id.length;x++){ 
            var option = document.createElement("option"); 
            option.setAttribute("value",id[x]);
            option.appendChild(document.createTextNode(value[x])); 
            select.appendChild(option);
        } 
    })
    $('#eng').on('click', function() {
        $('#chisave').css("display","none");
        $('#engsave').css("display","block");
        $('#mathsave').css("display","none");
        var id = new Array("Z1","Z2","Z3","5A","4A","3A","2A","A","B","C","D","E","F","G","H","I","J","K","L","M"); 
        var value = new Array("Z1(運筆教材)","Z2(運筆教材)","Z3(運筆教材)","5A","4A","3A","2A","A","B","C","D","E","F","G","H","I","J","K","L","M"); 
        var select = document.getElementById("no"); 
        select.length = 1;
        select.options[0].selected = true;
        for(var x = 0;x<id.length;x++){ 
            var option = document.createElement("option"); 
            option.setAttribute("value",id[x]);
            option.appendChild(document.createTextNode(value[x])); 
            select.appendChild(option);
        } 
    })
    var list=document.querySelectorAll(".suject input");
    function activeLink(){
          list.forEach(event=>{
              event.classList.remove('hovered');    
          })
          if(this.classList=="hovered"){
            this.classList.remove('hovered');
          }else{
            this.classList.add('hovered');
          }
    }
    list.forEach((item)=>item.addEventListener('click',activeLink));
</script>
